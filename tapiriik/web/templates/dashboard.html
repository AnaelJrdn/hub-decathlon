{% extends "site.html" %}
{% load i18n %}
{% load services %}
{% load users %}
{% load displayutils %}
{% block title %}{% if user != none %}{% trans "dashboard" %}{% else %}{% trans "sync your runs, rides & more" %}{% endif %}{% endblock %}

{% block content %}
{% if user != none %}
	{% if user.ConnectedServices|length > 1 %}

		<div class="block">
			<div class="syncButtonBlock">
				<div class="syncButtonAttachment left">{% trans "Queueing to Synchronize" %}</div>
				<div class="syncButtonWrap">
					<a class="syncButton">{% trans "Synchronize now" %}<div class="syncButtonIcon"></div></a>
					<!--<a href="#/settings" class="syncSettingsNubbin"><span class="sr">{% trans "Synchronization Settings" %}</span><div class="syncSettingsNubbinIcon"></div></a>-->
				</div>
				<div class="syncButtonAttachment right">{% trans "Attached info 10%" %}</div>
			</div>
		</div> 
		<div class="block">
			{% include "recent-sync-activity-block.html" %}
		</div> 
		<div class="block">
			{% if user.NonblockingSyncErrorCount > 0 %}
				<a href="{% url 'activities_dashboard' %}" style="color:#aaa; font-size:80%;">{% trans "Some activities could not be synchronized." %}</a><br/>
			{% endif %}
		</div> 
		<div class="block">
			<div class="titleBlock">{% trans "Manage your services" %}</div>
			<div class="serviceButtonOuter">
				<div class="serviceButtonWrap row">
				{% for connection in user.ConnectedServices|svc_populate_conns %}
					{% with svc=connection.Service %}
						{% if svc.ID not in config.withdrawn_services %}
							{% include "service-button.html" with provider=svc connection=connection %}
						{% endif %}
					{% endwith %}
				{% endfor %}
				{% for provider in user.ConnectedServices|svc_providers_except %}
					{% if provider.ID not in config.soft_launch and provider.ID not in config.withdrawn_services %}
						{% include "service-button.html" with provider=provider inactive=True %}
					{% endif %}
				{% endfor %}
				</div>
			</div>
		</div>

		<div class="block">
			{% for connection in user.ConnectedServices|svc_populate_conns %}
				{% with svc=connection.Service %}
					{% for error in connection.SyncErrors %}
						{% if error.UserException.InterventionRequired and error.Block %}
							{% include "service-blockingexception.html" with provider=svc connection=connection exception=error %}
						{% endif %}
					{% endfor %}
				{% endwith %}
			{% endfor %}
		</div>
	{% endif %}

	<!-- tooltip blocks -->
	{% if user.ConnectedServices|length > 1 %}
		{% infotip connectedWillSync %}
			<div class="block">
				<div class="tooltip">{% trans "Connected services will be synchronized automatically" %}</div>
			</div>
		{% endinfotip %}
	{% else %}
		{% infotip connectOneMore %}
			<div class="block">
				<div class="tooltip">{% trans "Connect a second service to synchronize your activities to &amp; from" %}</div>
			</div>
		{% endinfotip %}
	{% endif %}	
		
	{% if user.Substitute %}
		<h1>{% trans "Substituting user" %}</h1>
		<a href="{% url 'diagnostics_unsu' %}">{% trans "Return" %}</a>
		<hr/>
	{% endif %}

{% else %}
	<div class="block">
		<p class="info">{% trans "exercisync synchronizes your activities between Aerobia, Garmin Connect, Polar Flow, PolarPersonalTrainer, Strava, RideWithGPS, Dropbox, Smashrun and BeginnerTriathlete<br/>	(your heart rate, cadence, power, and temperature data syncs too)" %}</p>

		<div class="serviceButtonOuter">
			<div class="serviceButtonWrap row">
			{% for provider in service_providers %}
				{% if provider.ID not in config.soft_launch and provider.ID not in config.withdrawn_services %}
					{% include "service-button.html" with provider=provider %}
				{% endif %}
			{% endfor %}
			</div>
		</div>
		<p class="info">{% trans "Did not find your service?" %} - {% trans "Try here" %}: <a id="tapiriikLink" href="https://tapiriik.com">tapiriik.com</a></p>
		<p class="info">{% trans "Your email, password, and fitness data are kept safe - full details on the" %} <a href="{% url "privacy" %}">{% trans "privacy page" %}</a>.</p>
	</div>
{% endif %}
{% endblock %}
